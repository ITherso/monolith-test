{% extends "base.html" %}

{% block title %}DNS-over-HTTPS C2 - CyberPunk{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-white flex items-center gap-3">
                <span class="text-4xl">üåê</span>
                DNS-over-HTTPS C2 Channel
                <span class="px-2 py-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs font-bold rounded-full animate-pulse">PRO</span>
            </h1>
            <p class="text-gray-400 mt-2">Firewall "Bu Google ile konu≈üuyor" sanarken, gizli C2 trafiƒüi ta≈üƒ±nƒ±r</p>
        </div>
        <a href="{{ url_for('main.dashboard') }}" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white transition-colors">
            ‚Üê Dashboard
        </a>
    </div>

    <!-- Info Banner -->
    <div class="bg-gradient-to-r from-green-900/50 to-emerald-900/50 border border-green-500/30 rounded-xl p-6">
        <div class="flex items-start gap-4">
            <div class="text-4xl">üîí</div>
            <div>
                <h3 class="text-green-400 font-bold text-lg">Neden DoH C2?</h3>
                <ul class="text-gray-300 mt-2 space-y-1 text-sm">
                    <li>‚úì <strong>HTTPS Encrypted</strong> - Firewall i√ßeriƒüi g√∂remez</li>
                    <li>‚úì <strong>Trusted Providers</strong> - Google DNS (8.8.8.8), Cloudflare (1.1.1.1)</li>
                    <li>‚úì <strong>Can't Block</strong> - Kim Google DNS'i engelleyebilir?</li>
                    <li>‚úì <strong>Double Encryption</strong> - TLS + AES-256</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Configuration Panel -->
        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <span>‚öôÔ∏è</span> Channel Configuration
            </h2>
            
            <form id="dohConfigForm" class="space-y-4">
                <div>
                    <label class="block text-gray-300 text-sm mb-2">C2 Domain</label>
                    <input type="text" id="c2Domain" value="c2.example.com" 
                           class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-green-500 focus:outline-none">
                    <p class="text-gray-500 text-xs mt-1">DNS queries will be subdomains of this domain</p>
                </div>
                
                <div>
                    <label class="block text-gray-300 text-sm mb-2">DoH Provider</label>
                    <select id="dohProvider" class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-green-500 focus:outline-none">
                        {% for provider in providers %}
                        <option value="{{ provider.name }}">{{ provider.display }} - {{ provider.url }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="block text-gray-300 text-sm mb-2">Client ID (Optional)</label>
                    <input type="text" id="clientId" placeholder="Auto-generated if empty"
                           class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-green-500 focus:outline-none">
                </div>
                
                <button type="submit" class="w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 rounded-lg text-white font-bold transition-all">
                    üöÄ Create Session
                </button>
            </form>
        </div>

        <!-- Implant Generator -->
        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <span>üíâ</span> Implant Generator
            </h2>
            
            <form id="implantForm" class="space-y-4">
                <div>
                    <label class="block text-gray-300 text-sm mb-2">Target Domain</label>
                    <input type="text" id="implantDomain" value="c2.example.com"
                           class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-green-500 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-gray-300 text-sm mb-2">Language</label>
                    <select id="implantLanguage" class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-green-500 focus:outline-none">
                        <option value="python">Python</option>
                        <option value="powershell">PowerShell</option>
                        <option value="csharp">C#</option>
                    </select>
                </div>
                
                <button type="submit" class="w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded-lg text-white font-bold transition-all">
                    üì¶ Generate Implant
                </button>
            </form>
        </div>
    </div>

    <!-- How It Works -->
    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
        <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
            <span>üîç</span> How DoH C2 Works
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="bg-gray-900 rounded-lg p-4 text-center">
                <div class="text-3xl mb-2">1Ô∏è‚É£</div>
                <h4 class="text-green-400 font-bold">Command Encoded</h4>
                <p class="text-gray-400 text-sm mt-1">Commands are base32 encoded and split into DNS labels</p>
            </div>
            <div class="bg-gray-900 rounded-lg p-4 text-center">
                <div class="text-3xl mb-2">2Ô∏è‚É£</div>
                <h4 class="text-green-400 font-bold">DNS Query Built</h4>
                <p class="text-gray-400 text-sm mt-1">data.chunk1.chunk2.session.c2.domain.com</p>
            </div>
            <div class="bg-gray-900 rounded-lg p-4 text-center">
                <div class="text-3xl mb-2">3Ô∏è‚É£</div>
                <h4 class="text-green-400 font-bold">DoH Request</h4>
                <p class="text-gray-400 text-sm mt-1">HTTPS POST to dns.google/dns-query</p>
            </div>
            <div class="bg-gray-900 rounded-lg p-4 text-center">
                <div class="text-3xl mb-2">4Ô∏è‚É£</div>
                <h4 class="text-green-400 font-bold">Response</h4>
                <p class="text-gray-400 text-sm mt-1">TXT record contains response data</p>
            </div>
        </div>
    </div>

    <!-- Session Info -->
    <div id="sessionInfo" class="hidden bg-gray-800 rounded-xl p-6 border border-green-500">
        <h2 class="text-xl font-bold text-green-400 mb-4">‚úì Session Created</h2>
        <div id="sessionDetails" class="bg-gray-900 rounded-lg p-4 font-mono text-sm text-gray-300"></div>
    </div>

    <!-- Implant Code -->
    <div id="implantCode" class="hidden bg-gray-800 rounded-xl p-6 border border-purple-500">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-purple-400">üíâ Generated Implant</h2>
            <button onclick="copyImplant()" class="px-4 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-white text-sm transition-colors">
                üìã Copy Code
            </button>
        </div>
        <pre id="implantContent" class="bg-gray-900 rounded-lg p-4 overflow-x-auto text-sm text-green-400 max-h-96 overflow-y-auto"></pre>
    </div>

    <!-- Traffic Analysis -->
    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
        <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
            <span>üìä</span> What Firewall Sees
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-red-900/30 rounded-lg p-4 border border-red-500/30">
                <h4 class="text-red-400 font-bold mb-2">‚ùå Traditional C2</h4>
                <code class="text-gray-300 text-sm">
                    Connection to suspicious-c2.ru:443<br>
                    ‚Üí BLOCKED by firewall
                </code>
            </div>
            <div class="bg-green-900/30 rounded-lg p-4 border border-green-500/30">
                <h4 class="text-green-400 font-bold mb-2">‚úì DoH C2</h4>
                <code class="text-gray-300 text-sm">
                    Connection to dns.google.com:443<br>
                    ‚Üí ALLOWED (it's Google DNS!)
                </code>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('dohConfigForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const response = await fetch('/doh-c2/api/create-session', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            domain: document.getElementById('c2Domain').value,
            provider: document.getElementById('dohProvider').value,
            client_id: document.getElementById('clientId').value || undefined
        })
    });
    
    const data = await response.json();
    
    if (data.success) {
        document.getElementById('sessionInfo').classList.remove('hidden');
        document.getElementById('sessionDetails').innerHTML = `
            <p><strong>Session ID:</strong> ${data.session.session_id}</p>
            <p><strong>Client ID:</strong> ${data.session.client_id}</p>
            <p><strong>Provider:</strong> ${data.channel.provider}</p>
            <p><strong>Domain:</strong> ${data.channel.domain}</p>
            <p><strong>Encoding:</strong> ${data.channel.encoding}</p>
        `;
    } else {
        alert('Error: ' + data.error);
    }
});

document.getElementById('implantForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const response = await fetch('/doh-c2/api/generate-implant', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            domain: document.getElementById('implantDomain').value,
            provider: document.getElementById('dohProvider').value,
            language: document.getElementById('implantLanguage').value
        })
    });
    
    const data = await response.json();
    
    if (data.success) {
        document.getElementById('implantCode').classList.remove('hidden');
        document.getElementById('implantContent').textContent = data.code;
    } else {
        alert('Error: ' + data.error);
    }
});

function copyImplant() {
    const code = document.getElementById('implantContent').textContent;
    navigator.clipboard.writeText(code);
    alert('Implant code copied to clipboard!');
}
</script>
{% endblock %}
